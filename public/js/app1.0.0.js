!function(){"use strict";angular.module("unicerApp",["MapModule"])}(),function(){"use strict";angular.module("AuthenticationModule",[])}(),function(){"use strict";angular.module("BaseDocumentalModule",[])}(),function(){"use strict";angular.module("DrawingModule",[])}(),function(){"use strict";angular.module("LegendsModule",[])}(),function(){"use strict";angular.module("MapModule",[])}(),function(){"use strict";angular.module("MapInteractionsModule",[])}(),function(){"use strict";angular.module("PrintingModule",["DrawingModule"])}(),function(){"use strict";angular.module("SearchLocationModule",["ui.select","ngSanitize"])}(),function(){"use strict";function e(e,t,n){var o=this;this.submit=function(a){e.submitted=!0,a.$invalid||n.login(o.username,o.password).then(function(o){o.data.layers.forEach(function(e){t.addLayer(e)}),n.loginUser(o.data.username),e.closeThisDialog()},function(e){o.invalidUser=!0,o.invalidPass=!0,o.message="O login falhou."})},this.reset=function(e){o[e]=!1}}angular.module("AuthenticationModule").controller("DialogController",e),e.$inject=["$scope","LayersFactory","CredentialsService"]}(),function(){"use strict";function e(e,t,n,o){var a=this;this.login=function(){e.open({template:"app/templates/login.html",className:"ngdialog-theme-default",showClose:!1,controller:"DialogController",controllerAs:"dialogCtrl"})},this.logout=function(){n.logout().then(function(e){o.removeProtectedLayers(),n.logoutUser()},function(e){o.removeProtectedLayers(),n.logoutUser()})},t.$watch(function(){return n.isUserLogged()},function(e){a.isLogged=n.isUserLogged(),a.username=n.getUsername()}),function(){a.isLogged=n.isUserLogged(),a.username=n.getUsername(),window.ctrl=a}()}angular.module("AuthenticationModule").controller("LoginController",e),e.$inject=["ngDialog","$scope","CredentialsService","LayersFactory"]}(),function(){"use strict";function e(e){function t(t,n){return e({url:"/credentials/login",method:"POST",data:{username:t,password:n},xhrFields:{withCredentials:!0}})}function n(){return e({url:"/credentials/logout",method:"POST"})}function o(e){s=e,c=!0}function a(){s="",c=!1}function r(){return c}function i(){return s}var s="",c=!1;this.login=t,this.logout=n,this.loginUser=o,this.logoutUser=a,this.isUserLogged=r,this.getUsername=i}angular.module("AuthenticationModule").service("CredentialsService",e),e.$inject=["$http"]}(),function(){"use strict";function e(){return{bindToController:!0,controller:t,controllerAs:"catCtrl",restrict:"E",scope:{},templateUrl:"app/templates/category.html"}}function t(e){var t=this;!function(){t.isActive=!1,t.baseAddress=e.getBaseAddress(),t.items=e.getData()}(),t.setActive=function(e){t.active==e?t.isActive=!t.isActive:t.isActive=!0,t.active=e,t.subIndex=-1}}angular.module("BaseDocumentalModule").directive("categoryList",e),t.$inject=["BaseDocumentalService"]}(),function(){"use strict";function e(){return{bindToController:!0,controller:t,controllerAs:"subCatCtrl",restrict:"E",scope:{subcategory:"=",baseAddress:"=",active:"=index"},templateUrl:"app/templates/subcategory.html"}}function t(){var e=this;e.setActive=function(t){e.active=t}}angular.module("BaseDocumentalModule").directive("subcategoryList",e)}(),function(){"use strict";function e(){function e(){return"http://www.cm-vilareal.pt/images/cidadao/urbanismo/PDM/"}function t(){return[{categoria:"Plantas de Condicionantes",content:[{subcategoria:"Áreas Florestais Percorridas por Incêndio",content:[{name:"PLANTA-A",address:"ordenamento/areas_florestais_percorridas_incendio_planta_a.pdf"},{name:"PLANTA-B",address:"ordenamento/acustico_dia_planta_b.pdf"}],img:"app/img/a-b.png"},{subcategoria:"Perigosidade de Incêndio",content:[{name:"PLANTA-A",address:"ordenamento/risco_incendio_planta_a.pdf"},{name:"PLANTA-B",address:"ordenamento/risco_incendio_planta_b.pdf"}],img:"app/img/a-b.png"},{subcategoria:"Planta de Condicionantes",content:[{name:"PLANTA-A",address:"ordenamento/condicionantes_planta_a.pdf"},{name:"PLANTA-B",address:"ordenamento/condicionantes_planta_b.pdf"},{name:"PLANTA-C",address:"ordenamento/condicionantes_planta_c.pdf"},{name:"PLANTA-D",address:"ordenamento/condicionantes_planta_d.pdf"},{name:"PLANTA-E",address:"ordenamento/condicionantes_planta_e.pdf"},{name:"PLANTA-F",address:"ordenamento/condicionantes_planta_f.pdf"},{name:"PLANTA-G",address:"ordenamento/condicionantes_planta_g.pdf"}],img:"app/img/a-g.png"}]},{categoria:"Plantas de Ordenamento",content:[{subcategoria:"Qualificação do Solo",content:[{name:"PLANTA-A",address:"ordenamento/solo_planta_a.pdf"},{name:"PLANTA-B",address:"ordenamento/solo_planta_b.pdf"},{name:"PLANTA-C",address:"ordenamento/solo_planta_c.pdf"},{name:"PLANTA-D",address:"ordenamento/solo_planta_d.pdf"},{name:"PLANTA-E",address:"ordenamento/solo_planta_e.pdf"},{name:"PLANTA-F",address:"ordenamento/solo_planta_f.pdf"},{name:"PLANTA-G",address:"ordenamento/solo_planta_g.pdf"}],img:"app/img/a-g.png"},{subcategoria:"Zonamento Acústico",content:[{name:"Dia | PLANTA-A",address:"ordenamento/acustico_dia_planta_a.pdf"},{name:"Dia | PLANTA-B",address:"ordenamento/acustico_dia_planta_b.pdf"},{name:"Noite | PLANTA-A",address:"ordenamento/acustico_noite_planta_a.pdf"},{name:"Noite | PLANTA-B",address:"ordenamento/acustico_noite_planta_a.pdf"}],img:"app/img/a-b.png"}]},{categoria:"Regulamento",content:[{subcategoria:"Regulamento",content:[{name:"Regulamento do Plano Diretor Municipal (Aviso n.º 7317 de 2011)",address:"ordenamento/aviso7317_2011_PDMVR.pdf"}]}]},{categoria:"Correcções Materiais",content:[{subcategoria:"Correcções Materiais",content:[{name:"Correção material do Plano Diretor Municipal de Vila Real - DR n.º 178/2013",address:"dr_178_2013.pdf"},{name:"Correção material do Plano Diretor Municipal de Vila Real - DR n.º 29/2014",address:"dr_29_2014.pdf"},{name:"Correção material do Plano Diretor Municipal de Vila Real - DR n.º 202/2014",address:"dr_229_2014.pdf"}]}]},{categoria:"Relatório de Discussão Pública",content:[{subcategoria:"Relatório de Discussão Pública",content:[{name:"Relatório de Discussão Pública",address:"relat_discussao_publica_pdm.pdf"}]}]}]}this.getData=t,this.getBaseAddress=e}angular.module("BaseDocumentalModule").service("BaseDocumentalService",e)}(),function(){"use strict";function e(e,t,n){function o(e){switch(e){case"Point":u.info="Para desenhar um ponto, faça clique no mapa.";break;case"LineString":u.info="Para desenhar uma linha, vá clicando no mapa. Duplo clique termina a linha.";break;case"Polygon":u.info="Para desenhar um polígono, vá clicando no mapa. Duplo clique fecha o polígono."}}var a,r,i,s,c,l,u=this,d=t.map,p=n,g="Utilize os botões para definir o tipo de desenho desejado.";!function(){a=new ol.format.GeoJSON({featureProjection:ol.proj.get("EPSG:27493")}),r=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(174, 0, 0, 0.3)"}),stroke:new ol.style.Stroke({color:"rgba(0,0,0,0.75)",width:2}),image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"rgba(174, 0, 0, 0.3)"}),stroke:new ol.style.Stroke({color:"rgba(0,0,0,0.75)"})})}),i=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.3)"}),stroke:new ol.style.Stroke({color:"rgba(174,0,0,0.75)",width:2}),image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"rgba(174,0,0,0.75)"}),stroke:new ol.style.Stroke({color:"rgba(255, 255, 255, 0.3)"})})}),s=new ol.source.Vector({wrapX:!1}),s.on("addfeature",function(){t.userFeatures=a.writeFeatures(c.getSource().getFeatures(),{dataProjection:ol.proj.get("EPSG:27493"),featureProjection:"EPSG:3857"})}),c=new ol.layer.Vector({source:s,style:r}),u.info=g}(),u.setDrawingMode=function(n){p.setMapInteraction("DragPan"),o(n),d.removeInteraction(l),d.removeLayer(c),l=new ol.interaction.Draw({source:s,style:i,type:n}),d.addInteraction(l),l.once("drawend",function(n){n.feature.set("type",n.feature.getGeometry().getType()),t.map.removeInteraction(l),u.info=g,e.$apply()}),d.addLayer(c)},u.clearDraw=function(){d.removeLayer(c),c.getSource().clear()},e.$on("resetPrinting",function(){u.clearDraw()})}angular.module("DrawingModule").controller("DrawingController",e),e.$inject=["$scope","MapService","MapInteractionsService"]}(),function(){"use strict";function e(e,t){e.groups=t.groups}angular.module("LegendsModule").controller("LegendsController",e),e.$inject=["$scope","LegendsService"]}(),function(){"use strict";function e(){function e(e,t){return e.findIndex(function(e){return e.title==this.title},t)}function t(e,t){e.splice(t,1)}this.groups=[],this.addLayerLegend=function(t){var n=e(this.groups,t.parent);n>-1?-1==e(this.groups[n].data,t)&&this.groups[n].data.push({title:t.title,workspace:t.data.workspace,name:t.data.name}):(this.groups.push({title:t.parent.title,data:[]}),this.groups[this.groups.length-1].data.push({title:t.title,workspace:t.data.workspace,name:t.data.name}))}.bind(this),this.removeLayerLegend=function(n){var o=e(this.groups,n.parent),a=e(this.groups[o].data,n);t(this.groups[o].data,a),0==this.groups[o].data.length&&t(this.groups,o)}.bind(this)}angular.module("LegendsModule").service("LegendsService",e)}(),function(){"use strict";function e(e,t){var n=this;!function(){n.baseLayers=[{name:"Open Street Map",layerDef:new ol.layer.Tile({source:new ol.source.OSM({})})},{name:"Camada em Branco",layerDef:new ol.layer.Tile({})}],n.baseLayer="Mapa de Base"}(),n.setBaseLayer=function(e){n.baseLayer=e.name,t.setBaseLayer(e.layerDef)}}angular.module("MapModule").controller("BaseLayerController",e),e.$inject=["$scope","MapService"]}(),function(){"use strict";function e(e){var t=this;e.groups=[],t.expandTree=function(){e.tree.visit(function(e){e.setExpanded(!0)})},t.collapseTree=function(){e.tree.visit(function(e){e.setExpanded(!1)})},t.deselectAll=function(){e.tree.visit(function(e){e.setSelected(!1)})},t.hideMenu=function(){e.$parent.menuIsHidden=!0},t.help=function(){alert(" Em Desenvolvimento... ")}}angular.module("MapModule").controller("TabsController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,n){function o(e,t,n){console.log("Creating FancyTree")}return{bindToController:!0,controller:"TabsController",controllerAs:"tc",link:o,restrict:"E",scope:{menuIsHidden:"="},templateUrl:"public/views/templates/tabs.html"}}angular.module("MapModule").directive("controlPanel",e),e.$inject=["LayersFactory","MapService","$timeout"]}(),function(){"use strict";function e(){function e(e){$("#tree").fancytree("getTree").visit(function(t){t.isFolder()&&t.title==e.title&&e.children.forEach(function(e){e.extraClasses="protected",t.addChildren(e,0)})})}function t(){var e=[];$("#tree").fancytree("getTree").visit(function(t){!t.isFolder()&&t.data.protected&&e.push(t.key)});for(var t=0;t<e.length;t++){$("#tree").fancytree("getTree").getNodeByKey(e[t]).remove()}}return{glyph_opts:{map:{checkbox:"fa fa-toggle-off",checkboxSelected:"fa fa-toggle-on",checkboxUnknown:"fa fa-circle",doc:"fa fa-search",docOpen:"fa fa-search",error:"fa fa-exclamation-triangle",expanderClosed:"fa  fa-arrow-right",expanderLazy:"fa fa-arrow-right",expanderOpen:"fa fa-arrow-down",folder:"fa fa-folder",folderOpen:"fa fa-folder-open",loading:"fa fa-spinner"}},addLayer:e,removeProtectedLayers:t}}angular.module("MapModule").factory("LayersFactory",e)}(),function(){"use strict";function e(e){function t(t){e({method:"GET",url:"/api/freguesias"}).then(function(e){t(e.data)},function(e){console.error(e)})}function n(t){e({method:"GET",url:"/api/localidades"}).then(function(e){t(e.data)},function(e){console.error(e)})}return{getFreguesias:t,getLocalidades:n}}angular.module("MapModule").factory("LocationsFactory",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(e){proj4.defs("EPSG:27493","+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.98999999999999 +ellps=intl +towgs84=-223.237,110.193,36.649,0,0,0,0 +units=m +no_defs");var t=[-127101.82,-300782.39,160592.41,278542.12];ol.proj.get("EPSG:27493").setExtent(t),h=angular.extend(m,e),f=new ol.Map({target:h.target,layers:[new ol.layer.Tile({source:new ol.source.OSM({}),queryable:!1})],interactions:h.interactions,controls:h.controls,view:new ol.View({center:ol.proj.transform(h.center,"EPSG:4326","EPSG:3857"),zoom:h.zoom,extent:[-928405.1144335504,5033494.2861691285,-777977.0427683234,5078592.132857382],minZoom:11})}),f.getView().on("change:resolution",function(e){var t=e.target.getZoom();t===parseInt(t,10)&&$("#tree").fancytree("getTree").visit(function(e){e.isFolder()||void 0!=e.data.minZoom&&(e.data.minZoom<t?e.removeClass("layer-hidden"):e.addClass("layer-hidden"))})})}function n(e){f.getLayers().setAt(0,e)}function o(e){"WMS"===e.type?r(e):"TileWMS"===e.type?a(e):d(e)}function a(e){if(l(e.key)){var t=new ol.layer.Tile({opacity:e.opacity,source:new ol.source.TileWMS({url:"https://gistree.espigueiro.pt:3001/wms",params:{LAYERS:e.workspace+":"+e.name},extent:e.extent}),minResolution:u(e.maxZoom),maxResolution:u(e.minZoom),group:e.group,queryable:e.queryable});p[e.key]=t,f.getLayers().insertLayer(t),p[e.key].visible=!0}else p[e.key].visible||(f.getLayers().insertLayer(p[e.key]),p[e.key].visible=!0)}function r(e){if(l(e.key)){var t=new ol.layer.Image({opacity:e.opacity,source:new ol.source.ImageWMS({url:"https://gistree.espigueiro.pt:3001/wms",params:{LAYERS:e.workspace+":"+e.name},extent:e.extent}),minResolution:u(e.maxZoom),maxResolution:u(e.minZoom),group:e.group,queryable:e.queryable});p[e.key]=t,f.getLayers().insertLayer(t),p[e.key].visible=!0}else p[e.key].visible||(f.getLayers().insertLayer(p[e.key]),p[e.key].visible=!0)}function i(e){p[e.key]&&(f.removeLayer(p[e.key]),p[e.key].visible=!1)}function s(){f.setView(new ol.View({center:ol.proj.transform(h.center,"EPSG:4326","EPSG:3857"),zoom:h.zoom,extent:[-928405.1144335504,5033494.2861691285,-777977.0427683234,5078592.132857382],minZoom:11}))}function c(e,t){var n=f.getView();window.view=n,f.getView().animate({zoom:11,duration:500},{center:ol.proj.transform(e,ol.proj.get(t),"EPSG:3857"),duration:1500,zoom:15})}function l(e){return!p.hasOwnProperty(e)}function u(e){return void 0===e?e:Math.floor(156543.04/Math.pow(2,e))}function d(e){if(l(e.key)){var t=new ol.layer.Vector({source:new ol.source.Vector({loader:function(n){$.ajax("http://gistree.espigueiro.pt/geoserver/wfs",{type:"GET",data:{service:"WFS",version:"1.1.1",request:"GetFeature",typename:e.workspace+":"+e.name,srsname:"EPSG:27493",outputFormat:"application/json",bbox:ol.proj.transformExtent(n,"EPSG:3857",ol.proj.get("EPSG:27493")).join(",")+","+ol.proj.get("EPSG:27493").getCode()},crossDomain:!0}).done(function(e){t.getSource().addFeatures((new ol.format.GeoJSON).readFeatures(e,{featureProjection:"EPSG:3857",dataProjection:ol.proj.get("EPSG:27493")}))})},strategy:ol.loadingstrategy.bbox})});p[e.key]=t,e.style&&(t.setStyle(new ol.style.Style(e.style)),t.setOpacity(e.opacity)),f.addLayer(t),p[e.key].visible=!0}else p[e.key].visible||(f.addLayer(p[e.key]),p[e.key].visible=!0)}var p={},g={};if(!ol)return{};var f={},m={zoom:11,target:"map",center:[-7.7464,41.2951],interactions:[new ol.interaction.MouseWheelZoom,new ol.interaction.DragPan],controls:[new ol.control.ScaleLine,new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",layers:[new ol.layer.Image({source:new ol.source.ImageWMS({url:"https://gistree.espigueiro.pt:3001/wms",params:{LAYERS:"cmvrpostgis:limite_freguesias"},extent:[-127028.95781617332,-301620.79631591577,173162.9865501142,278637.28586892004]})}),new ol.layer.Image({source:new ol.source.ImageWMS({url:"https://gistree.espigueiro.pt:3001/wms",params:{LAYERS:"cmvrpostgis:limite_concelho"},extent:[-127028.95781617332,-301620.79631591577,173162.9865501142,278637.28586892004]})})],collapseLabel:"-",label:"+",collapsed:!1,tipLabel:""})]},h={};return angular.equals(f,{})&&t(),{map:f,init:t,addLayer:o,removeLayer:i,setDefaultView:s,userFeatures:g,setBaseLayer:n,zoomToCoordinate:c}}angular.module("MapModule").factory("MapService",e),e.$inject=["$http"],ol.Collection.prototype.insertLayer=function(e){var t=this.getArray().findIndex(function(t){return t.get("group")<e.get("group")});-1!==t?this.insertAt(t,e):this.push(e)},ol.layer.Base.prototype.isQueryable=function(){return this.get("queryable")}}(),function(){"use strict";function e(e,t){var n=this;!function(){n.results=[]}(),n.title="Resultados da Pesquisa",e.$watchCollection(function(){return t.getResults()},function(e){n.results=e}),n.hasResults=function(){return n.results.length>0}}angular.module("MapInteractionsModule").controller("LayerResultsController",e),e.$inject=["$scope","LayerQueryResultsService"]}(),function(){"use strict";function e(e,t,n,o){o.setMapInteraction("DragPan"),this.search=!1,this.isActive=function(e){return this.active==e},this.setDefaultView=function(e){n.setDefaultView()},this.setInteraction=function(e){o.setMapInteraction(e)},this.showMenu=function(){this.menuIsHidden=!1},this.showSearchBar=function(){this.search=!this.search},this.isSearch=function(){return!this.search},e.$watch(function(){return o.getMapInteraction()},function(t){e.itCtrl.active=t}),e.$watch("itCtrl.active",function(){e.itCtrl.currentInteraction=o.getText()}),e.$watch("itCtrl.menuIsHidden",function(){t(function(){n.map.updateSize()},10)})}angular.module("MapInteractionsModule").controller("MapInteractionsController",e),e.$inject=["$scope","$timeout","MapService","MapInteractionsService"]}(),function(){"use strict";function e(e){function t(t,n,o){e.map.addControl(new ol.control.MousePosition({coordinateFormat:function(e){return ol.coordinate.format(e," {x} , {y} ",4)},projection:"EPSG:4326",className:"",target:document.getElementById("coordinate4326"),undefinedHTML:"&nbsp;"})),e.map.addControl(new ol.control.MousePosition({coordinateFormat:function(e){return ol.coordinate.format(e," {x} , {y} ",4)},projection:ol.proj.get("EPSG:27493"),className:"",target:document.getElementById("coordinate27493"),undefinedHTML:"&nbsp;"}))}return{bindToController:!0,controller:"MapInteractionsController",controllerAs:"itCtrl",link:t,restrict:"E",scope:{menuIsHidden:"="},templateUrl:"app/templates/MapInteractionsTemplate.html"}}angular.module("MapInteractionsModule").directive("mapInteractions",e),e.$inject=["MapService"]}(),function(){"use strict";function e(){return function(e){return angular.isNumber(e)?e:e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}angular.module("MapInteractionsModule").filter("capitalize",e)}(),function(){"use strict";function e(e){function t(t,n,r){r.forEach(function(r){if(r.isQueryable()){var i=r.getSource().getGetFeatureInfoUrl(ol.proj.transform(t.coordinate,"EPSG:3857",ol.proj.get("EPSG:27493")),n.getResolution(),ol.proj.get("EPSG:27493"),{INFO_FORMAT:"application/json"});if(i){o();new ol.format.GeoJSON;e({url:i}).then(function(e){e.data.features.length>0&&a.push(e.data)})}}})}function n(){return a}function o(){a.length=0}var a=[];this.getResults=n,this.getLayersInfo=t,this.clearResults=o}angular.module("MapInteractionsModule").service("LayerQueryResultsService",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,n){var o={interaction:"",interactionText:""};this.setMapInteraction=function(n){switch(e.map.getInteractions().pop(),n){case"DragPan":o.interactionText="Mover Mapa",e.map.addInteraction(new ol.interaction.DragPan);break;case"ZoomIn":o.interactionText="Aproximar Mapa",e.map.addInteraction(new ol.interaction.Pointer({handleDownEvent:function(t){var n=e.map.getView();n.setCenter(t.coordinate),n.setZoom(n.getZoom()+1)}}));break;case"ZoomOut":o.interactionText="Afastar Mapa",e.map.addInteraction(new ol.interaction.Pointer({handleDownEvent:function(t){var n=e.map.getView();n.setCenter(t.coordinate),n.setZoom(n.getZoom()-1)}}));break;case"ZoomBox":o.interactionText="Fazer Zoom de Caixa",e.map.addInteraction(new ol.interaction.DragZoom({condition:ol.events.condition.always,className:"drag_zoom_box"}));break;case"Identify":o.interactionText="Identificar Camadas",e.map.addInteraction(new ol.interaction.Pointer({handleDownEvent:function(e){t.getLayersInfo(e,e.map.getView(),e.map.getLayers().getArray())}}))}o.interaction=n},this.getMapInteraction=function(){return o.interaction},this.getText=function(){return o.interactionText},this.setText=function(e){o.interactionText=e}}angular.module("MapInteractionsModule").service("MapInteractionsService",e),e.$inject=["MapService","LayerQueryResultsService","$http"]}(),function(){"use strict";function e(e,t){function n(){o.userData={requerente:"",proprietario:"",nif:"",freguesia:"",local:""},t.setDetails(o.userData)}var o=this;n(),e.$on("resetPrinting",function(){n()})}angular.module("PrintingModule").controller("FormController",e),e.$inject=["$scope","PrintDetailsService"]}(),function(){"use strict";function e(e,t){function n(){o.selected=!1,e.getFreguesias(function(e){o.freguesias=e}),o.freguesia="Freguesia"}var o=this;n(),o.setFreguesia=function(e){o.selected=!0,o.freguesia=e.name,t.$parent.formCtrl.userData.freguesia=e.name},o.isSelected=function(){return o.selected},t.$on("resetPrinting",function(){n()})}angular.module("PrintingModule").controller("FreguesiasController",e),e.$inject=["LocationsFactory","$scope"]}(),function(){"use strict";function e(e,t,n,o){function a(){r.layouts=[{selected:!1,name:"Planta de Ordenamento",layout:"pdmLayout",title:"Planta de Ordenamento",escala:1e4,type:"ordenamento",tamanho:"A3"},{selected:!1,name:"Planta de Condicionantes",layout:"pdmLayout",title:"Planta de Condicionantes",type:"condicionantes",escala:1e4,tamanho:"A3"}],r.noSelect=!0}var r=this;a(),this.change=function(){r.noSelect=!r.layouts.some(function(e){return!0===e.selected})},this.printLayouts=function(){var e=[];r.layouts.forEach(function(o){o.selected&&e.push(n.post("https://gistree.espigueiro.pt:3001/geoserver",t.getPrintSpec(o.name,o.type)))}),o.all(e).then(function(e){e.forEach(function(e){var n="https://gistree.espigueiro.pt:3001/geoserver/pdf?_doc="+e.data.getURL.split("/").pop();t.addNewResult({title:e.config.data.mapTitle,url:n})})})},e.$on("resetPrinting",function(){a()})}angular.module("PrintingModule").controller("LayoutSelectionController",e),e.$inject=["$scope","PrintDetailsService","$http","$q"]}(),function(){"use strict";function e(e){var t=this;!function(){t.active=1}(),this.activeTab=function(e){return e==t.active},this.nextPage=function(e){e&&t.active++},e.$on("resetPrinting",function(){t.active=1})}angular.module("PrintingModule").controller("PagesController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t){var n=this;!function(){n.printResults=t.getPrintResults(),n.message1="A processar o seu pedido.",n.message2="Por favor aguarde..."}(),this.newPrint=function(){e.$parent.$broadcast("resetPrinting"),t.resetPrintResults()}}angular.module("PrintingModule").controller("PrintResultController",e),e.$inject=["$scope","PrintDetailsService"]}(),function(){"use strict";function e(e){var t={"Planta de Ordenamento":[{type:"WMS",format:"image/png",layers:["cmvrpostgis:solo_rural","cmvrpostgis:solo_urbano","cmvrpostgis:solo_de_urbanizacao_programada","cmvrpostgis:estrutura_ecologica_urbana","cmvrpostgis:outras_instalacoes","cmvrpostgis:zonas_de_protecao_ao_aerodromo"],baseURL:"http://gistree.espigueiro.pt:8081/geoserver/wms",customParams:{}}],"Planta de Condicionantes":[{type:"WMS",format:"image/png",layers:["cmvrpostgis:reserva_agricola_nacional","cmvrpostgis:reserva_ecologica_nacional","cmvrpostgis:zonas_inundaveis","cmvrpostgis:pedreiras","cmvrpostgis:limite_da_rede_natura_2000","cmvrpostgis:aerodromo","cmvrpostgis:linhas_de_alta_tensao","cmvrpostgis:abastecimento_de_aguas_adutoras","cmvrpostgis:rede_rodoviaria","cmvrpostgis:rede_rodoviaria_prevista","cmvrpostgis:rede_ferroviaria","cmvrpostgis:vertices_geodesicos"],baseURL:"http://gistree.espigueiro.pt:8081/geoserver/wms",customParams:{}}]},n=[],o={};this.addNewResult=function(e){n.push(e)},this.getPrintResults=function(){return n},this.resetPrintResults=function(){n.splice(0,n.length)},this.setDetails=function(e){o=e},this.getDetails=function(){return o},this.getPrintSpec=function(n,a){var r={layout:"pdmLayout",srs:"EPSG:27493",units:"m",outputFormat:"pdf",mapTitle:n,type:a,layers:[],pages:[{center:ol.proj.transform(e.map.getView().getCenter(),"EPSG:3857",ol.proj.get("EPSG:27493")),scale:1e4,dpi:300}]};return r.outputFilename=n.split(" ").join("_"),r.pages[0].MapTitle=n,angular.copy(t[n],r.layers),angular.equals(e.userFeatures,{})||r.layers.push({type:"Vector",styles:{"":{strokeColor:"#000000",strokeWidth:"2",fillColor:"#ae0000",fillOpacity:.7}},opacity:"0.8",geoJson:JSON.parse(e.userFeatures)}),angular.extend(r.pages[0],o),r}}angular.module("PrintingModule").service("PrintDetailsService",e),e.$inject=["MapService"]}(),function(){"use strict";function e(e,t){var n=this;!function(){e.getLocalidades(function(e){n.locations=e.features}),n.location={}}(),n.onSelectCallback=function(e){t.zoomToCoordinate(e.geometry.coordinates[0],"EPSG:27493")}}angular.module("SearchLocationModule").controller("LocationController",e),e.$inject=["LocationsFactory","MapService"]}(),function(){"use strict";angular.module("SearchLocationModule").filter("propsFilter",function(){return function(e,t){var n=[];if(angular.isArray(e)){var o=Object.keys(t);e.forEach(function(e){for(var a=!1,r=0;r<o.length;r++){var i=o[r],s=t[i].toLowerCase();if(-1!==e[i].toString().toLowerCase().indexOf(s)){a=!0;break}}a&&n.push(e)})}else n=e;return n}})}();